<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="css/talkroom.css">
    <title>TalkRoom</title>
</head>

<body>
    <div id="room">

        <div class="box-left">
            <p class="message-box white">Hello!!</p>
        </div>

        <div class="box-right">
            <p class="message-box green">Happy new year!!</p>
        </div>

    </div>

    <div class="input-group chat-input">
    <textarea id="inputMessage" cols="50"  class="form-control" placeholder="メッセージを入力してください" oninput="textAreaHeightSet(this)"></textarea>
        <div class="input-group-append">
            <button id="sendBtn" class="btn btn-primary" type="button" >送信</button>
        </div>
    </div>

    <script>
        let isMySelf = true;

        let sendBtn = document.getElementById('sendBtn');
        sendBtn.addEventListener('click', function () {

            let inputMessage = document.getElementById('inputMessage');
            let messageText = inputMessage.value.replace(/\r\n|\r/g,"\n");
            console.log("inputmessage:" + messageText);
            if (messageText == '') {
                return;
            }

            let messageBox = document.createElement('div');

            if (isMySelf) {
                messageBox.classList.add('box-right');
            } else {
                messageBox.classList.add('box-left');
            }

            var message;
            var lines = messageText.split('\n');
            if(lines.length === 1){
                console.log("kaigyou : nasi");
                message = document.createElement('p');
            } else {
                console.log("kaigyou: " + lines.length);
                message = document.createElement('textarea');
                //message.setAttribute("oninput","textAreaHeightSet(this)");
                message.setAttribute("style","overflow:hidden");
                message.style.height = lines.length * 30 + "px";
                console.log("height:" + message.style.height);

            }
            message.setAttribute("disabled","true");
            message.textContent = messageText;
            console.log("message2:"+ message.textContent);
            message.classList.add('message-box');

            if (isMySelf) {
                message.classList.add('green');
            } else {
                message.classList.add('white');
            }

            messageBox.appendChild(message);

            let room = document.getElementById('room');

            room.appendChild(messageBox);

            isMySelf = !isMySelf;

            inputMessage.value = '';
        })

        /*
        textarea height control
        */
        function textAreaHeightSet(argObj){
            console.log("height controll start!");
            argObj.style.height = "10px";
            var wScrollHeight = parseInt(argObj.scrollHeight);
            var wLineH = parseInt(argObj.style.lineHeight.replace(/px/,''));
            if(wScrollHeight < (wLineH *2)){
                wScrollHeight = (wLineH *2);
            }
            argObj.style.height = wScrollHeight + "px";         
        }

    </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
</body>

</html>